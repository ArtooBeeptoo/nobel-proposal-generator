<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nobel Biocare Proposal Generator</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #003366 0%, #004d99 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { margin: 0; font-size: 24px; }
        .header a { color: white; text-decoration: none; opacity: 0.8; }
        .header a:hover { opacity: 1; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px; }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 30px;
            margin-bottom: 30px;
        }
        .card h2 {
            margin-top: 0;
            color: #003366;
            border-bottom: 2px solid #003366;
            padding-bottom: 10px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 15px; }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
        }
        input:focus, select:focus { outline: none; border-color: #003366; }
        
        .discount-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .discount-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }
        .discount-item label {
            font-size: 13px;
            margin-bottom: 4px;
        }
        .discount-item input {
            padding: 8px;
            font-size: 14px;
        }
        
        .search-box { margin-bottom: 20px; }
        .search-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .category-section { margin-bottom: 20px; }
        .category-title {
            background: #f0f4f8;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #003366;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category-title:hover { background: #e5ebf1; }
        .category-title .arrow { transition: transform 0.3s; }
        .category-title.open .arrow { transform: rotate(180deg); }
        .products-list { display: none; margin-top: 10px; }
        .products-list.open { display: block; }
        .product-row {
            display: grid;
            grid-template-columns: 1fr 80px 100px;
            gap: 15px;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        .product-row:hover { background: #f9fafb; }
        .product-desc { font-size: 14px; }
        .product-id { color: #666; font-size: 12px; }
        .product-price { color: #003366; font-weight: 600; text-align: right; }
        .qty-input { width: 70px; padding: 8px; text-align: center; }
        
        .output-options { display: flex; gap: 20px; margin: 20px 0; }
        .output-option { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .output-option input { width: 18px; height: 18px; }
        
        .btn-generate {
            background: linear-gradient(135deg, #003366 0%, #004d99 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        .btn-generate:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,51,102,0.3); }
        
        .selected-count {
            background: #003366;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 13px;
        }
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            .product-row { grid-template-columns: 1fr; gap: 8px; }
            .form-row { grid-template-columns: 1fr; }
            .discount-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Nobel Biocare Proposal Generator</h1>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>
    
    <div class="container">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="error">{{ messages[0] }}</div>
        {% endif %}
        {% endwith %}
        
        <form method="POST" action="{{ url_for('generate') }}" id="proposalForm">
            <div class="card">
                <h2>Proposal Details</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="account_name">Account Name *</label>
                        <input type="text" id="account_name" name="account_name" required placeholder="e.g., Smith Dental">
                    </div>
                    <div class="form-group">
                        <label for="rep_name">Territory Manager</label>
                        <input type="text" id="rep_name" name="rep_name" placeholder="Your name (optional)">
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Discounts by Category</h2>
                <p style="color: #666; margin-top: 0;">Set different discount percentages for each product category</p>
                <div class="discount-grid">
                    {% for group in discount_groups %}
                    <div class="discount-item">
                        <label for="discount_{{ group.replace(' ', '_').replace('-', '_') }}">{{ group }} %</label>
                        <input type="number" 
                               id="discount_{{ group.replace(' ', '_').replace('-', '_') }}" 
                               name="discount_{{ group.replace(' ', '_').replace('-', '_') }}" 
                               value="0" min="0" max="100" step="1">
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="card">
                <h2>Select Products <span class="selected-count" id="selectedCount">0 selected</span></h2>
                
                <div class="search-box">
                    <input type="text" id="productSearch" placeholder="ðŸ” Search products by name or item #...">
                </div>
                
                {% for category, prods in products.items() %}
                <div class="category-section" data-category="{{ category }}">
                    <div class="category-title" onclick="toggleCategory(this)">
                        <span>{{ category }} ({{ prods|length }})</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="products-list">
                        {% for prod in prods %}
                        <div class="product-row" data-search="{{ prod.description|lower }} {{ prod.id|lower }}">
                            <div>
                                <div class="product-desc">{{ prod.description }}</div>
                                <div class="product-id">{{ prod.id }}</div>
                            </div>
                            <div class="product-price">${{ "{:,.0f}".format(prod.price) }}</div>
                            <input type="number" class="qty-input" name="qty_{{ prod.id }}" min="0" value="0" onchange="updateCount()">
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="card">
                <h2>Output Format</h2>
                <div class="output-options">
                    <label class="output-option">
                        <input type="radio" name="output_format" value="docx" checked>
                        <span>ðŸ“„ Word Document (.docx) - Editable</span>
                    </label>
                    <label class="output-option">
                        <input type="radio" name="output_format" value="pdf">
                        <span>ðŸ“• PDF - For sharing</span>
                    </label>
                </div>
                
                <button type="submit" class="btn-generate">Generate Proposal</button>
            </div>
        </form>
    </div>
    
    <script>
        function toggleCategory(el) {
            el.classList.toggle('open');
            el.nextElementSibling.classList.toggle('open');
        }
        
        function updateCount() {
            const inputs = document.querySelectorAll('.qty-input');
            let count = 0;
            inputs.forEach(input => {
                if (parseInt(input.value) > 0) count++;
            });
            document.getElementById('selectedCount').textContent = count + ' selected';
        }
        
        document.getElementById('productSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.product-row');
            const categories = document.querySelectorAll('.category-section');
            
            rows.forEach(row => {
                const searchText = row.dataset.search;
                row.style.display = searchText.includes(query) ? '' : 'none';
            });
            
            categories.forEach(cat => {
                const visibleProducts = cat.querySelectorAll('.product-row:not([style*="display: none"])');
                if (query && visibleProducts.length > 0) {
                    cat.querySelector('.products-list').classList.add('open');
                    cat.querySelector('.category-title').classList.add('open');
                }
            });
        });
    </script>
</body>
</html>
