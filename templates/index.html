<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nobel Biocare Proposal Generator</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #003366 0%, #004d99 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { margin: 0; font-size: 24px; }
        .header a { color: white; text-decoration: none; opacity: 0.8; }
        .header a:hover { opacity: 1; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px; }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 30px;
            margin-bottom: 30px;
        }
        .card h2 {
            margin-top: 0;
            color: #003366;
            border-bottom: 2px solid #003366;
            padding-bottom: 10px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group { margin-bottom: 15px; }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
        }
        input:focus, select:focus { outline: none; border-color: #003366; }
        
        .discount-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        .discount-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }
        .discount-item label {
            font-size: 13px;
            margin-bottom: 4px;
        }
        .discount-item input {
            padding: 8px;
            font-size: 14px;
        }
        
        .quick-nav {
            background: #f0f4f8;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .quick-nav-label {
            font-weight: 600;
            color: #666;
            font-size: 13px;
        }
        .quick-nav a {
            background: #003366;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }
        .quick-nav a:hover {
            background: #004d99;
        }
        .search-box { margin-bottom: 20px; }
        .search-box input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .category-section { margin-bottom: 20px; }
        .category-title {
            background: #f0f4f8;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #003366;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category-title:hover { background: #e5ebf1; }
        .category-title .arrow { transition: transform 0.3s; }
        .category-title.open .arrow { transform: rotate(180deg); }
        .products-list { display: none; margin-top: 10px; }
        .products-list.open { display: block; }
        .product-row {
            display: grid;
            grid-template-columns: 1fr 80px 100px;
            gap: 15px;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        .product-row:hover { background: #f9fafb; }
        .product-desc { font-size: 14px; }
        .product-id { color: #666; font-size: 12px; }
        .product-price { color: #003366; font-weight: 600; text-align: right; }
        .qty-input { width: 70px; padding: 8px; text-align: center; }
        
        .output-options { display: flex; gap: 20px; margin: 20px 0; }
        .output-option { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .output-option input { width: 18px; height: 18px; }
        
        .btn-generate {
            background: linear-gradient(135deg, #003366 0%, #004d99 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        .btn-generate:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,51,102,0.3); }
        
        .selected-count {
            background: #003366;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 13px;
        }
        .error {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        @media (max-width: 600px) {
            .product-row { grid-template-columns: 1fr; gap: 8px; }
            .form-row { grid-template-columns: 1fr; }
            .discount-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Nobel Biocare Proposal Generator</h1>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>
    
    <div class="container">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
        <div class="error">{{ messages[0] }}</div>
        {% endif %}
        {% endwith %}
        
        <form method="POST" action="{{ url_for('generate') }}" id="proposalForm">
            <div class="card">
                <h2>Proposal Details</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="account_name">Account Name *</label>
                        <input type="text" id="account_name" name="account_name" required placeholder="e.g., Smith Dental">
                    </div>
                    <div class="form-group">
                        <label for="rep_name">Territory Manager</label>
                        <input type="text" id="rep_name" name="rep_name" placeholder="Your name (optional)">
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Discounts by Category</h2>
                <p style="color: #666; margin-top: 0;">Set different discount percentages for each product category</p>
                
                <div style="margin-bottom: 20px;">
                    <span style="font-weight: 600; margin-right: 10px;">Quick presets:</span>
                    <button type="button" onclick="applyPreset('standard')" style="padding: 8px 16px; margin-right: 8px; border: 2px solid #003366; background: white; color: #003366; border-radius: 6px; cursor: pointer; font-weight: 500;">Standard (30/25/20)</button>
                    <button type="button" onclick="applyPreset('aggressive')" style="padding: 8px 16px; margin-right: 8px; border: 2px solid #003366; background: white; color: #003366; border-radius: 6px; cursor: pointer; font-weight: 500;">Aggressive (40/35/30)</button>
                    <button type="button" onclick="applyPreset('light')" style="padding: 8px 16px; margin-right: 8px; border: 2px solid #003366; background: white; color: #003366; border-radius: 6px; cursor: pointer; font-weight: 500;">Light (20/15/10)</button>
                    <button type="button" onclick="applyPreset('clear')" style="padding: 8px 16px; border: 2px solid #999; background: white; color: #666; border-radius: 6px; cursor: pointer; font-weight: 500;">Clear All</button>
                </div>
                
                <div class="discount-grid">
                    {% for group in discount_groups %}
                    <div class="discount-item">
                        <label for="discount_{{ group.replace(' ', '_').replace('-', '_') }}">{{ group }} %</label>
                        <input type="number" 
                               id="discount_{{ group.replace(' ', '_').replace('-', '_') }}" 
                               name="discount_{{ group.replace(' ', '_').replace('-', '_') }}" 
                               value="0" min="0" max="100" step="1">
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="card">
                <h2>Select Products <span class="selected-count" id="selectedCount">0 selected</span></h2>
                
                <div class="quick-nav">
                    <span class="quick-nav-label">Jump to:</span>
                    <a href="#" onclick="jumpTo('Implants'); return false;">Implants</a>
                    <a href="#" onclick="jumpTo('Abutments'); return false;">Abutments</a>
                    <a href="#" onclick="jumpTo('Regenerative'); return false;">Regenerative</a>
                    <a href="#" onclick="jumpTo('Surgical Kits'); return false;">Surgical Kits</a>
                    <a href="#" onclick="jumpTo('Capital - 3Shape'); return false;">3Shape</a>
                    <a href="#" onclick="jumpTo('Capital - SprintRay'); return false;">SprintRay</a>
                    <a href="#" onclick="jumpTo('Capital - DEXIS'); return false;">DEXIS</a>
                    <a href="#" onclick="jumpTo('Capital - X-Guide'); return false;">X-Guide</a>
                    <a href="#" onclick="jumpTo('Capital - iCAM'); return false;">iCAM</a>
                    <a href="#" onclick="jumpTo('Capital - DTX'); return false;">DTX</a>
                </div>
                
                <div class="search-box">
                    <input type="text" id="productSearch" placeholder="ðŸ” Search products by name or item #...">
                </div>
                
                {% for category, prods in products.items() %}
                <div class="category-section" data-category="{{ category }}" id="cat-{{ category | replace(' ', '-') | replace('/', '-') }}">
                    <div class="category-title" onclick="toggleCategory(this)">
                        <span>{{ category }} ({{ prods|length }})</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="products-list">
                        {% for prod in prods %}
                        <div class="product-row" data-search="{{ prod.description|lower }} {{ prod.id|lower }}">
                            <div>
                                <div class="product-desc">{{ prod.description }}</div>
                                <div class="product-id">{{ prod.id }}</div>
                            </div>
                            <div class="product-price">${{ "{:,.0f}".format(prod.price) }}</div>
                            <input type="number" class="qty-input" name="qty_{{ prod.id }}" min="0" value="0" onchange="updateCount()">
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="card">
                <h2>Notes / Comments</h2>
                <div class="form-group">
                    <label for="notes">Add any notes or special terms for this proposal (optional)</label>
                    <textarea id="notes" name="notes" rows="4" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 15px; font-family: inherit; resize: vertical;" placeholder="e.g., Pricing valid for 30 days. Training included with capital equipment purchase."></textarea>
                </div>
            </div>
            
            <div class="card">
                <h2>Output Format</h2>
                <div class="output-options">
                    <label class="output-option">
                        <input type="radio" name="output_format" value="docx" checked>
                        <span>ðŸ“„ Word Document (.docx) - Editable</span>
                    </label>
                    <label class="output-option">
                        <input type="radio" name="output_format" value="pdf">
                        <span>ðŸ“• PDF - For sharing</span>
                    </label>
                </div>
                
                <button type="submit" class="btn-generate">Generate Proposal</button>
            </div>
        </form>
    </div>
    
    <script>
        function applyPreset(preset) {
            const presets = {
                'standard': { Implants: 30, Abutments: 25, Kits: 20, '3Shape': 10, SprintRay: 10, DEXIS: 10, 'X_Guide': 10, iCAM: 10, DTX: 10, Other: 15 },
                'aggressive': { Implants: 40, Abutments: 35, Kits: 30, '3Shape': 15, SprintRay: 15, DEXIS: 15, 'X_Guide': 15, iCAM: 15, DTX: 15, Other: 25 },
                'light': { Implants: 20, Abutments: 15, Kits: 10, '3Shape': 5, SprintRay: 5, DEXIS: 5, 'X_Guide': 5, iCAM: 5, DTX: 5, Other: 10 },
                'clear': { Implants: 0, Abutments: 0, Kits: 0, '3Shape': 0, SprintRay: 0, DEXIS: 0, 'X_Guide': 0, iCAM: 0, DTX: 0, Other: 0 }
            };
            const values = presets[preset];
            if (!values) return;
            
            for (const [group, val] of Object.entries(values)) {
                const input = document.getElementById('discount_' + group);
                if (input) input.value = val;
            }
        }
        
        function jumpTo(categoryName) {
            // Find all category sections and look for matching one
            const sections = document.querySelectorAll('.category-section');
            for (const section of sections) {
                const cat = section.dataset.category;
                if (cat.includes(categoryName) || categoryName.includes(cat.split(' ')[0])) {
                    // Open the category
                    section.querySelector('.products-list').classList.add('open');
                    section.querySelector('.category-title').classList.add('open');
                    // Scroll to it
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    return;
                }
            }
        }
        
        function toggleCategory(el) {
            el.classList.toggle('open');
            el.nextElementSibling.classList.toggle('open');
        }
        
        function updateCount() {
            const inputs = document.querySelectorAll('.qty-input');
            let count = 0;
            inputs.forEach(input => {
                if (parseInt(input.value) > 0) count++;
            });
            document.getElementById('selectedCount').textContent = count + ' selected';
        }
        
        document.getElementById('productSearch').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.product-row');
            const categories = document.querySelectorAll('.category-section');
            
            rows.forEach(row => {
                const searchText = row.dataset.search;
                row.style.display = searchText.includes(query) ? '' : 'none';
            });
            
            categories.forEach(cat => {
                const visibleProducts = cat.querySelectorAll('.product-row:not([style*="display: none"])');
                if (query && visibleProducts.length > 0) {
                    cat.querySelector('.products-list').classList.add('open');
                    cat.querySelector('.category-title').classList.add('open');
                }
            });
        });
    </script>
</body>
</html>
